import knowledge


def match_from_lookup_YOUR_ATTRIBUTE(record):
    for base_name in [item for item in dir(knowledge) if not item.startswith("__")]:
        base_list = getattr(knowledge, base_name)
        for terms in base_list:
            # please make sure to exchange "your-attribute"
            yield_idxs_list = match_term_to_doc_idxs(terms, record["your-attribute"])
            for yield_idxs in yield_idxs_list:
                yield base_name, yield_idxs[0], yield_idxs[1]


def match_term_to_doc_idxs(terms, doc):
    term_list = terms.lower().split()
    term_stack = term_list.copy()[::-1]
    start_idx, stop_idx = None, None
    matches = []
    new_candidate = False
    for idx, token in enumerate(doc):
        if token.text.lower() == term_list[0]:
            start_idx = idx
            term_stack.pop()
            if len(term_stack) == 0:
                matches.append([start_idx, start_idx])
                term_stack = term_list.copy()[::-1]
            else:
                new_candidate = True
        elif new_candidate:
            if token.text.lower() == term_stack.pop():
                if len(term_stack) == 0:
                    stop_idx = idx
                    matches.append([start_idx, stop_idx])
                    term_stack = term_list.copy()[::-1]
            else:
                new_candidate = False
                term_stack = term_list.copy()[::-1]

    return matches
